/* ChatBot v1.0 */
!function(){"use strict";function t(t,...e){return String.raw({raw:t},...e)}class e extends HTMLElement{static props=[];static define(t,e={}){return customElements.define(t,this,e),this}static get observedAttributes(){return this.props||[]}constructor(t={}){super(),this._state={},this._props={},this.attachShadow({mode:"open"}),Object.entries(t).forEach((([t,e])=>{this._props[t]=e}));const e=this.initState();e&&"object"==typeof e&&(this._state=e)}initState(){return{}}get state(){return{...this._state}}setState(t){this._state={...this._state,...t}}get props(){return{...this._props}}connectedCallback(){this.syncAttributesToProps(),this._render(),this._afterRender(),this.handleEvent&&n.subscribeToAll(this)}handleEvent(t){}syncAttributesToProps(){(this.constructor.observedAttributes||[]).forEach((t=>{this.hasAttribute(t)&&(this._props[t]=this.getAttribute(t))}))}attributeChangedCallback(t,e,n){e!==n&&(this._props[t]=n,this._render())}adaptCallback(){this._render()}cleanup(){}$(t){return this.shadowRoot.querySelector(t)}$$(t){return this.shadowRoot.querySelectorAll(t)}listen(t,e,n){const s="string"==typeof t?this.$(t):t;s instanceof HTMLElement?s.addEventListener(e,n.bind(this)):console.warn("Target element is not an HTMLElement:",s)}_afterRender(){this.setupListeners()}setupListeners(){}template(){return""}_render(){this.shadowRoot.innerHTML="";const t=document.createElement("template");t.innerHTML=`\n<style>\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  font-family: var(--font-family, inherit), system-ui;\n}\nimg {\n  max-width: 100%;\n  max-height: 100%;\n  display: block;\n}\nsvg { display: block; }\nbutton {\n  border: none;\n  outline: none;\n  background-color: transparent;\n  cursor: pointer;\n}\n</style> ${this.template()}`,this.shadowRoot.appendChild(t.content.cloneNode(!0))}}class n{static events={};static subscribers=new Map;static subscribeToEvent(t,e){n.events[t]||(n.events[t]=[]),n.events[t].push(e),n.subscribers.has(e)||n.subscribers.set(e,new Set),n.subscribers.get(e).add(t)}static subscribeToAll(t){const e=t.constructor.events;e&&Array.isArray(e)&&e.forEach((e=>{n.subscribeToEvent(e,t)}))}static unsubscribeFromEvent(t,e){n.events[t]&&(n.events[t]=n.events[t].filter((t=>t!==e)),n.subscribers.has(e)&&(n.subscribers.get(e).delete(t),0===n.subscribers.get(e).size&&n.subscribers.delete(e)))}static unsubscribeAll(t){n.subscribers.has(t)&&([...n.subscribers.get(t)].forEach((e=>{n.unsubscribeFromEvent(e,t)})),n.subscribers.delete(t))}static triggerEvent(t,e){n.events[t]&&n.events[t].forEach((n=>{"function"==typeof n.handleEvent&&n.handleEvent(t,e)}))}}class s{static async request(t,e={}){try{const n=await fetch(t,e),s=await n.json();if(!n.ok)throw{status:n.status,response:s,message:`HTTP error: ${n.status}`};return s}catch(t){throw console.error("HTTP request failed",t),t}}static get(t,e={}){return s.request(t,{...e,method:"GET"})}static post(t,e,n={}){return s.request(t,{...n,method:"POST",headers:{"Content-Type":"application/json",...n.headers},body:JSON.stringify(e)})}}var i=new class{#t={autoShow:!1,animations:!0,maximized:!1,presentation:!1,position:"bottom-right",logo_url:"https://storage.googleapis.com/luccid-company-logos/Luccid%20Icon.png",font_url:"https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap",shadows:!0,uploadFiles:!0,maxCharacters:512,warningTreshold:20,loading:{speed:1e3,words:["Analyzing","Processing","Calculating","Consulting","Researching","Retrieving data","Building response","Finding solutions","Checking specifications","Reviewing materials"]},colors:{primary:"#2e34e0",textColor:"#111",textBotColor:"#111",userMessageBackground:"#fff",botMessageBackground:"#fff",borderColor:"#ddd",borderRadius:16,error:"#f44336",success:"#66bb6a"},window:{dimensions:{width:420,height:620}},button:{dimensions:{width:48,height:48}},text:{title:"Title",subtitle:"Learn everything about me",placeholder:"Ask me anything?",initialMessage:"Hello! I am Luccid, an AI‑powered platform designed for building material manufacturers, combining intelligent chat and real‑time analytics to improve sales, tech support, customer interactions, and market insights. How can I help you today?"},titles:{maximize:"Maximize",startNewChat:"Start new chat",send:"Send",characterLimit:"Character limit"},roles:[{buttonLabel:"Support",initialMessage:"Support role initial message"},{buttonLabel:"Tech",initialMessage:"Tech role initial message"}],suggestionQuestions:[],serverUrl:"http://34.121.136.169:8000",hmacServerURL:"http://34.121.136.169:8001",endpoints:{feedback:"/feedback",askQuestion:"/process",files:"/files",hmac:"/getHmacToken"},credentials:{client_id:"megasrbin1",password:"megasrbin333",company_id:"isoplussystemde"},files:{supported:["jpg","pdf","png"]}};#e={...this.#t};#n=null;constructor(){this.initialized=!1;const t=Array.from(document.getElementsByTagName("script"));for(let e of t){const t=e.getAttribute("data-config");if(t){this.#n=t;break}}}async init(){try{if(!this.#n)return this.#e={...this.#t},this.initialized=!0,this;const t=await fetch(this.#n,{method:"GET",cache:"no-cache"});if(t.ok){const e=await t.json();this.#e={...this.#e,...e},console.log(`Loaded configuration from: ${this.#n}`)}else console.warn(`Failed to load config from ${this.#n}, using defaults`),this.#e={...this.#t}}catch(t){console.error("Failed to load remote config, using defaults: ",t),this.#e={...this.#t}}finally{this.initialized=!0}return this}get credentials(){return this.config.credentials}getEndpoint(t){return this.#e.serverUrl+this.#e.endpoints[t]}getHmacEndpoint(){return this.#e.hmacServerURL+this.#e.endpoints.hmac}get config(){return this.initialized?this.#e:(console.warn("Config not initialized yet, call init() first."),null)}};(class extends e{static events=["window-state"];initState(){return{isOpen:!1,config:i.config}}handleEvent(t,e){"window-state"===t&&this.setState({isOpen:e})}setupListeners(){this.listen(this,"click",(t=>{this.setState({isOpen:!this.state.isOpen}),n.triggerEvent("window-state",this.state.isOpen),this.state.config.animations&&this.$("button").animate({transform:["scale(0.95)","scale(1.2)","scale(0.9)","scale(1)"]},{duration:1e3,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)"})})),this.state.config.animations?this.listen(this.$("img"),"load",(()=>this.$("button").style.animation="spin 500ms ease forwards")):(this.$("button").style.opacity="1",this.$("button").style.transform="rotateY(0deg)")}template(){return t(`\n      <style>\n        :host {\n          margin-left: auto;\n          width: var(--button-width);\n          height: var(--button-height);\n          display: block;\n          z-index: 999;\n          filter: drop-shadow(0px 10px 15px rgba(0, 0, 0, 0.1)) drop-shadow(0px 4px 6px rgba(0, 0, 0, 0.1));\n\n          @media(max-width: 480px) {\n            z-index: 0;\n          }\n\n          .chat-btn {\n            filter: drop-shadow(0 0 1px white);\n          }\n        }\n        @keyframes spin {\n          from {\n            opacity: 0;\n            transform: rotateY(180deg);\n          }\n          to {\n            opacity: 1;\n            transform: rotateY(0);\n          }\n        }\n      </style>\n      <button class="chat-btn">\n        <img src="${this.state.config.logo_url}" />\n      </button>\n    `)}}).define("chat-button");const o=' <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>',a='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload-icon lucide-upload"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>';class r{constructor(t,e){this.config=t,this.conversation_id=e,this.credentials=this.config.credentials}async sendMessage(t,e){const n=`${Math.floor(Date.now()/1e3)}:${navigator.userAgent}:{"question": "${t}"}`;return s.post(this.config.getHmacEndpoint(),{message:n}).then((i=>s.post(this.config.getEndpoint("askQuestion"),{query:t,conversation_id:this.conversation_id,client_id:this.credentials.client_id,password:this.credentials.password,company_id:this.credentials.company_id,suggestedQuestion:e},{headers:{"X-Auth-Token":`${i.token}`,"X-Auth-Message":n}}))).catch((t=>{throw new Error(t)}))}async sendfiles(t){return s.post(this.config.getEndpoint("files"),t)}async sendFeedback(t){const e=`${Math.floor(Date.now()/1e3)}:${navigator.userAgent}:{"question": "${t.user_question}"}`;return s.post(this.config.getHmacEndpoint(),{message:e}).then((n=>s.post(this.config.getEndpoint("feedback"),t,{headers:{"X-Auth-Token":`${n.token}`,"X-Auth-Message":e}})))}}class l{constructor(){this.keys={conversationId:"conversation_id",currentRole:"currentRole",messages:"messages",showSuggestions:"showSuggestions"}}get(t){const e=localStorage.getItem(this.keys[t]);return e?JSON.parse(e):null}set(t,e){localStorage.setItem(this.keys[t],JSON.stringify(e))}clear(...t){0===t.length?localStorage.clear():t.forEach((t=>localStorage.removeItem(this.keys[t])))}saveConversation(t,e,n,s=!0){const i=n.filter((t=>!t.isSystem&&"Loading ..."!==t.content));this.set("conversationId",t),this.set("currentRole",e),this.set("messages",i),this.set("showSuggestions",s)}loadConversation(){return{conversationId:this.get("conversationId"),currentRole:this.get("currentRole"),messages:this.get("messages")||[],showSuggestions:!1!==this.get("show_suggestions")}}}(class extends e{static props=["user-message-id","feedback-type"];static events=["feedback-sent"];constructor(){super(),this.storage=new l,this.stored=this.storage.loadConversation()}setupListeners(){this.listen(this.$("#negative"),"click",(()=>this.handleFeedback("negative"))),this.listen(this.$("#positive"),"click",(()=>this.handleFeedback("positive")))}connectedCallback(){super.connectedCallback(),this.$("#feedback-container").classList.add(`feedback-${this.props["feedback-type"]}`)}handleFeedback(t){"negative"===t&&n.triggerEvent("feedback-popup",!0),n.triggerEvent("feedback-submitted",{messageId:this.props["user-message-id"],type:t}),this.$("#feedback-container").classList.remove("feedback-positive","feedback-negative"),this.$("#feedback-container").classList.add(`feedback-${t}`)}template(){return t('\n      <style>\n        :host {\n          position: absolute;\n          bottom: 0px;\n          right: -12px;\n\n          z-index: 9999;\n\n          .feedback-container {\n            display: flex;\n            gap: 0.125rem;\n            border: 1px solid var(--colors-primary);\n            border-radius: 0.5rem;\n            padding: 0.25rem;\n            background-color: white;\n\n            button {\n              border: 1px solid transparent;\n              transition: all 500ms ease;\n              padding-block: 0.125rem;\n              padding-inline: 0.25rem;\n              display: grid;\n              place-items: center;\n              border-radius: 4px;\n\n              &:hover {\n                background-color: #eee;\n                border-color: var(--colors-border-color);\n              }\n            }\n\n            &.feedback-positive #positive {\n              svg {\n                fill: #111;\n              }\n            }\n            &.feedback-negative #negative {\n              svg {\n                fill: #111;\n              }\n            }\n          }\n        }\n      </style>\n        <div id="feedback-container" class="feedback-container">\n        <button id="positive">\n          \n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="14"\n  height="14"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round">\n  <path d="M7 10v12" />\n  <path\n    d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z" />\n</svg>\n        </button>\n        <button id="negative">\n          \n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="14"\n  height="14"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round">\n  <path d="M17 14V2" />\n  <path\n    d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z" />\n</svg>\n        </button>\n      </div>\n    ')}}).define("chat-feedback"),class extends e{initState(){return{config:i.config,isLoading:!1,intervalID:null}}connectedCallback(){super.connectedCallback(),this.setupContent()}setupContent(){this.state.config.animations&&(this.style.animation="rise 500ms ease forwards");const t=this.$("#content-container");if(!t)return;let e=this.getAttribute("content");const s=this.getAttribute("timestamp")||Date.now(),i="true"===this.getAttribute("feedback-enabled"),o="bot"===this.getAttribute("sender"),a="true"===this.getAttribute("is-system"),r="true"===this.getAttribute("from-storage"),l=this.getAttribute("feedback-type"),d=this.state.config.loading.words||[];if(d[d.length-1]!==d[0]&&d.push(d[0]),o&&"Loading ..."===e)return this.setState({isLoading:!0}),this.classList.add("loading"),t.innerHTML=`\n      <div class="loading-container">\n        <div class="loading-animation">\n          <img src="${this.state.config.logo_url}" />\n        </div>\n        <div class="loading-text">\n          <div class="loading-text-container">\n            ${d.length>0?d.map((t=>`<div class="loading-word">${t}</div>`)).join(""):""}\n          </div>\n        </div>\n      </div>\n        `,void this.animateWords();const c=function(t){if(!t)return"";const e=[];return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/!\[([^\]]+)\]\((data:image\/[^]+base64,[^)]+|[^)]+)\)/g,((t,n,s)=>(e.push(`<img src="${s}" alt="${n}">`),"")))).replace(/(^|\s)(data:image\/[^]+base64,[A-Za-z0-9+/=]+)(\s|$)/g,((t,n,s,i)=>(e.push(`<img src="${s}" alt="Base64 Image">`),n+i)))).replace(/</g,"&lt").replace(/>/g,"&gt")).replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1</a>')).replace(/(\w+)\((https?:\/\/[^\s)]+)\)/g,'<a href="$2">$1</a>')).replace(/(\*\*\*|___)(.*?)\1/g,"<strong><em>$2</em></strong>")).replace(/(\*\*|__)(.*?)\1/g,"<strong>$2</strong>")).replace(/^(#{1,6})\s*(.+)$/gm,((t,e,n)=>`<strong>${n.trim()}</strong>`))).replace(/(\*|_)(.*?)\1/g,"<em>$2</em>")).replace(/(?<!["'=])(https?:\/\/[^\s<]+)(?![^<]*>|[^<>]*<\/a>)/g,'<a href="$1">$1</a>')).replace(/\s+/g," ").trim(),e.length>0&&(t&&(t+="\n\n"),t+=`<div class="imgs-wrapper">${e.join("\n")}</div>`),t}(e);o&&(i||a)?a&&o?t.innerHTML=`<div class="content">${c}</div>`:(t.innerHTML=`\n    <div class="content"></div>\n    <div class="timestamp">\n      <chat-feedback user-message-id=${this.getAttribute("user-message-id")} feedback-type=${l} style="display: none"></chat-feedback>\n    </div>`,this.state.config.animations&&!r?function(t,e,n={}){var s;n={speed:(s=t.length,s<=100?150:s>=100&&s<=300?80:50),onComplete:null,...n};const i=t.split(" ");let o="";const a=[];i.forEach(((t,s)=>{const r=setTimeout((()=>{var r;o+=(s>0?" ":"")+t,e.innerHTML=o,n.onComplete&&i.length===s+1&&((r=a).forEach((t=>clearInterval(r))),r.length=0,n.onComplete())}),s*n.speed);a.push(r)}))}(c,this.$(".content"),{onComplete:()=>{n.triggerEvent("content-updated"),this.$(".timestamp chat-feedback").setAttribute("style",""),n.triggerEvent("answerd",!0)}}):(this.$(".content").innerHTML=c,this.$(".timestamp chat-feedback").setAttribute("style",""))):t.innerHTML=`\n      <div class="content">${c}</div>\n      <div class="timestamp">\n        ${this.formatTimestamp(s)}\n      </div>`}formatTimestamp(t){return new Intl.DateTimeFormat("default",{hour12:!1,hour:"2-digit",minute:"2-digit"}).format(t)}animateWords(){if(!this.state.isLoading)return;this.state.intervalID&&(clearInterval(this.state.intervalID),this.setState({intervalID:null}));const t=this.$(".loading-text-container");if(!t)return;const e=this.state.config.loading.words||[];if(0===e.length)return;let n=0;const s=setInterval((function(){t.style.transform=`translateY(-${22.4*n}px)`,t.style.transition="500ms ease",n++,n>=e.length&&(n=0,setTimeout((()=>{t.style.transform="translateY(-0px)",t.style.transition="none",n=1}),500))}),this.state.config.loading.speed);this.setState({intervalID:s})}template(){return t('\n      <style>\n        :host {\n          display: block;\n          max-width: 100%;\n          word-wrap: break-word;\n          position: relative;\n        }\n        :host([sender="user"]) {\n          padding: 10px !important;\n          border: 1px solid var(--colors-border-color);\n          border-radius: 10px;\n          background-color: var(--colors-user-message-background);\n          margin-left: auto !important;\n          width: max-content;\n          border-bottom-right-radius: 0;\n          scale: 0.95;\n          transform: translateY(20px);\n          .timestamp {\n            margin-left: auto !important;\n            width: max-content;\n          }\n        }\n        @keyframes rise {\n          to {\n            transform: translateY(0);\n            scale: 1;\n          }\n        }\n        :host([sender="bot"]) {\n          padding: 10px !important;\n          border: 1px solid var(--colors-primary);\n          border-radius: 10px;\n          background-color: var(--colors-bot-message-background);\n          margin-right: auto !important;\n          width: max-content;\n          border-bottom-left-radius: 0;\n          scale: 0.95;\n          transform: translateY(20px);\n          color: var(--colors-text-bot);\n\n          chat-feedback {\n            display: none;\n          }\n        }\n        :host([sender="bot"]:hover) {\n          chat-feedback {\n            display: block;\n          }\n        }\n        :host([sender="bot"]:last-child) {\n          chat-feedback {\n            display: block;\n          }\n        }\n        .timestamp {\n          font-size: 12px;\n          color: #757575;\n          position: absolute;\n          bottom: -20px;\n          right: 0;\n        }\n        @keyframes blinkCursor {\n          0%, 100% { border-right-color: transparent; }\n          50% { border-right-color: #555; }\n        }\n        .content.typing::after {\n          content: "";\n          display: inline-block;\n          width: 2px;\n          height: 1em;\n          background: #555;\n          margin-left: 2px;\n          vertical-align: text-bottom;\n          animation: blinkCursor 0.8s infinite;\n        }\n\n        .loading-container {\n          display: flex;\n          align-items: center;\n          gap: 14px;\n\n          .loading-animation {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            animation: pulse 1.5s ease-in-out infinite;\n\n            img {\n              width: 36px;\n              height: 36px;\n            }\n          }\n          .loading-text {\n            max-height: 22.4px;\n            line-height: 1;\n            overflow: hidden;\n          }\n\n          .loading-word {\n            font-size: 14px;\n            line-height: 1.6;\n            /* padding-block: 6px; */\n          }\n        }\n        @keyframes pulse {\n          0%, 100% {\n            transform: scale(1);\n          }\n          50% {\n            transform: scale(1.1);\n          }\n        }\n        :host(.loading) {\n          border: none;\n          background-color: transparent;\n        }\n        .imgs-wrapper {\n          display: flex;\n          gap: 12px;\n          margin-top: 24px;\n          img {\n            width: 100%;\n            border: 1px solid var(--colors-border-color);\n            border-radius: 8px;\n            max-width: 300px;\n          }\n        }\n      </style>\n      <div\n        id="content-container"\n        class="content-container">\n      </div>\n      <slot name="extra-content"></slot>\n    ')}}.define("chat-message"),class extends e{static events=["answerd","maximized"];initState(){return{config:i.config,shiftPressed:!1,message:"",MAX_CHARS:i.config.maxCharacters,WARNING_THRESHOLD:i.config.warningTreshold}}connectedCallback(){super.connectedCallback(),(this.state.config.maximized||this.state.config.presentation)&&(this.$("p:last-child").style.display="flex"),this.input instanceof HTMLTextAreaElement&&(this.input.maxLength=this.state.MAX_CHARS)}setupListeners(){this.input=this.$("#message-input"),this.inputBtn=this.$("#file-upload-btn"),this.sendBtn=this.$("#send-button"),this.actions=this.$(".actions"),this.kbdStatus=this.$("#kbd-status"),this.autogrowDiv=this.$(".autogrow"),this.circleProgress=this.$(".circle-progress"),this.listen(this,"keydown",(t=>"Shift"===t.key?this.setState({shiftPressed:!0}):null)),this.listen(this,"keyup",(t=>"Shift"===t.key?this.setState({shiftPressed:!1}):null)),this.listen(this.input,"input",this.handleInput.bind(this)),this.listen(this.sendBtn,"click",this.handleInput.bind(this)),this.listen(this.inputBtn,"click",(()=>n.triggerEvent("open-file-upload"))),this.autogrowDiv.setAttribute("data-replicated-value","")}handleEvent(t,e){"answerd"===t&&(e?(this.input instanceof HTMLTextAreaElement&&(this.input.disabled=!1),this.input.removeAttribute("disabled")):this.input instanceof HTMLTextAreaElement&&(this.input.disabled=!0)),"maximized"===t&&(this.$("p:last-child").style.display=e?"flex":"none")}handleInput(t){this.input instanceof HTMLTextAreaElement&&this.setState({message:this.input.value}),(t instanceof InputEvent&&"insertLineBreak"===t.inputType||"click"===t.type)&&!this.state.shiftPressed?(n.triggerEvent("message-sent",{message:this.state.message.replace(/\n/g,"")}),n.triggerEvent("answerd",!1),this.input instanceof HTMLTextAreaElement&&(this.input.value=""),this.setState({message:""}),this.autogrowDiv.setAttribute("data-replicated-value","")):this.input instanceof HTMLTextAreaElement&&this.autogrowDiv.setAttribute("data-replicated-value",this.input.value),this.toggleActionVisibility(),this.kbdStatus.classList.toggle("show",this.state.message.length>=6),this.updateCounter(this.state.message.length)}updateCounter(t){const e=2*Math.PI*12,n=this.state.MAX_CHARS-t,s=t/this.state.MAX_CHARS*e;this.circleProgress.style.strokeDasharray=`${s} ${e}`,this.circleProgress.classList.remove("circle-warning","circle-danger"),n<=0?this.circleProgress.classList.add("circle-danger"):n<=this.state.WARNING_THRESHOLD&&this.circleProgress.classList.add("circle-warning")}toggleActionVisibility(){this.state.message?this.actions.classList.add("show"):this.actions.classList.remove("show")}template(){const{text:e,titles:n}=this.state.config;return t(`\n      <style>\n        :host {\n          flex: 1;\n          color: var(--colors-text-color);\n\n          div {\n            display: flex;\n            align-items: center;\n            overflow: hidden;\n          }\n\n          .autogrow {\n            display: grid;\n            grid-template-columns: 1fr auto;\n            width: 100%;\n            max-width: 100%;\n            overflow-wrap: break-word;\n            background-color: white;\n\n            &::after {\n              content: attr(data-replicated-value) " ";\n              white-space: pre-wrap;\n              visibility: hidden;\n              overflow-wrap: break-word;\n              word-break: break-all;\n              overflow: hidden;\n              height: auto;\n              min-height: 24px;\n              max-height: 400px;\n              font: inherit;\n              padding: 0;\n            }\n\n            & > textarea,\n            &::after {\n              grid-area: 1 / 1 / 2 / 2;\n              font: inherit;\n              width: 100%;\n            }\n          }\n\n          textarea {\n            width: 100%;\n            height: 100%;\n            border: none;\n            outline: none;\n            resize: none;\n            overflow: hidden;\n            white-space: pre-wrap;\n            overflow-wrap: break-word;\n            word-break: break-all;\n            padding: 0;\n            font: inherit;\n            min-height: 24px;\n            word-break: break-word;\n          }\n\n          .actions {\n            margin-bottom: auto;\n            transform: translateX(50%);\n            transition: all 500ms ease;\n\n            label,\n            button {\n              width: 32px;\n              height: 32px;\n              border-radius: 8px;\n\n              display: grid;\n              place-items: center;\n\n              border: 1px solid transparent;\n              transition: all 500ms ease;\n\n              &:hover {\n                background-color: #eee;\n                color: var(--colors-text-color);\n                border: 1px solid var(--colors-border-color);\n                cursor: pointer;\n              }\n            }\n\n            #send-button {\n              filter: blur(5px);\n              opacity: 0;\n            }\n\n            &.show {\n              transform: translateX(0);\n\n              & #send-button {\n                filter: blur(0px);\n                opacity: 1;\n                margin-left: 4px;\n\n                color: var(--colors-primary);\n              }\n            }\n          }\n\n          p:not(:last-child) {\n            text-align: right;\n            font-size: 12px;\n            margin-top: -26px;\n            transition: all 500ms ease;\n            position: relative;\n            z-index: -1;\n            opacity: 0;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n\n            kbd {\n              padding: 0 10px;\n              background-color: #eee;\n              border-radius: 4px;\n              font-weight: 600;\n            }\n\n            &.show {\n              margin-top: 5px;\n              z-index: 0;\n              opacity: 1;\n            }\n\n            svg {\n              width: 24px;\n              height: 24px;\n            }\n            .circle-bg {\n              fill: none;\n              stroke: #e1e8ed;\n              stroke-width: 3;\n            }\n            .circle-progress {\n              fill: none;\n              stroke: var(--colors-primary);\n              stroke-width: 3;\n              stroke-linecap: round;\n              transform: rotate(-90deg);\n              transform-origin: 50% 50%;\n              transition: stroke-dasharray 0.3s ease;\n            }\n            .circle-warning {\n              stroke: #ffad1f;\n            }\n            .circle-danger {\n              stroke: #e0245e;\n            }\n          }\n          p:last-child {\n            margin-top: 12px;\n            font-size: 12px;\n            display: none;\n            justify-content: center;\n            align-items: center;\n            gap: 8px;\n          }\n        }\n      </style>\n      <div class="autogrow" data-replicated-value="">\n        <textarea\n          rows="1"\n          id="message-input"\n          placeholder="${this.state.config.text.placeholder}"\n          autofocus></textarea>\n        <div class="actions">\n          ${this.state.config.uploadFiles?'<button id="file-upload-btn">\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="18"\n  height="18"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n  class="lucide lucide-paperclip">\n  <path d="M13.234 20.252 L21 12.3" />\n  <path\n    d="m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486" />\n</svg></button>':""}\n          <button id="send-button" title="${n.send}">\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="18"\n  height="18"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n  class="lucide lucide-send-horizontal">\n  <path\n    d="M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z" />\n  <path d="M6 12h16" />\n</svg></button>\n        </div>\n      </div>\n      <p id="kbd-status">\n        <span title="${n.characterLimit}">\n          <svg viewBox="0 0 28 28">\n            <circle class="circle-bg" cx="14" cy="14" r="12"></circle>\n            <circle class="circle-progress" id="circle-progress" cx="14" cy="14" r="12" stroke-dasharray="0 75.4"></circle>\n          </svg>\n        </span>\n        <span>${e.newLineHint}</span></p>\n      <p>\n        <span style="display: block">powered by </span>\n        <a href="https://www.luccid.ai/" target="_blank">\n          <img height="20" src="https://luccid.ai/wp-content/uploads/2025/03/Luccid-Logotip.png" alt="" />\n        </a>\n      </p>\n    `)}}.define("message-input"),class extends e{static events=["feedback-popup"];setupListeners(){this.listen("#close-btn","click",(()=>n.triggerEvent("feedback-popup",!1))),this.listen("#submit-btn","click",this.handleSubmitFeedback)}initState(){return{config:i.config}}handleSubmitFeedback(){const t=this.$("input");if(t instanceof HTMLInputElement){const e=t.value;n.triggerEvent("feedback-submitted",{feedbackText:e,isFromPopup:!0}),n.triggerEvent("feedback-popup",!1),t.value=""}}handleEvent(t,e){"feedback-popup"===t&&e&&requestAnimationFrame((()=>this.$("input")?.focus()))}template(){const{feedbackPopup:e}=this.state.config.text;return t(`\n      <style>\n        :host {\n          width: 100%;\n        }\n        .fb-container {\n          width: 90%;\n          max-width: 350px;\n          box-shadow: 0 0 3px #ddd;\n          margin: auto;\n          background: white;\n          border: 1px solid var(--colors-border-color);\n          border-radius: 10px;\n          display: grid;\n          padding: 20px;\n          gap: 1rem;\n        }\n\n        input {\n          padding: 5px;\n          border-radius: 6px;\n          border: 1px solid var(--colors-border-color);\n          font-size: 14px;\n          outline: none;\n          width: 100%;\n          margin-top: 12px;\n        }\n\n        .fb-actions {\n          display: flex;\n          gap: 12px;\n          justify-content:  flex-end;\n        }\n        .fb-actions button {\n          padding: 4px 8px;\n          border: 1px solid var(--colors-border-color);\n          font-size: 14px;\n          border-radius: 6px;\n        }\n        .fb-actions .submit-btn {\n          background-color: var(--colors-primary);\n          color: white;\n          transition: all 250ms ease;\n        }\n        .submit-btn:hover {\n          background-color: var(--colors-primary-hover);\n        }\n      </style>\n      <div class="fb-container">\n        <label for="fb-input">\n          ${e.title}\n          <input type="text" id="fb-input" require placeholder="${e.placeholder}"/>\n        </label>\n        <div class="fb-actions">\n          <button class="close-btn" id="close-btn">${e.buttons.close}</button>\n          <button class="submit-btn" id="submit-btn">${e.buttons.submit}</button>\n        </div>\n      </div>\n    `)}}.define("feedback-popup"),class extends e{static events=["window-state","message-sent","content-updated","feedback-popup","feedback-submitted","answerd"];constructor(){super(),this.storage=new l,this.stored=this.storage.loadConversation(),this.conversation_id=this.stored.conversationId||crypto.randomUUID(),this.apiService=new r(i,this.conversation_id),this.setState({messages:this.stored.messages||[],currentRole:this.stored.currentRole||null,showSuggestions:!1!==this.stored.showSuggestions})}initState(){return{config:i.config,messages:[],isMaximized:i.config.maximized||!1,isPresentation:i.config.presentation||!1,scrolling:!1,roles:i.config.roles||[],currentRole:null,userMessageId:null,isInitialRender:!0,showSuggestions:!0}}_afterRender(){super._afterRender(),this.setupWindow(),this.renderInitialMessageWithRoles(),this.state.isMaximized&&(this.updateMaximizeButton(),this.classList.toggle("maximize")),this.state.isPresentation&&(this.id="presentation-mode",this.$("#maximize").remove(),this.$("#mobile-close-btn").remove())}setupListeners(){this.maximizeBtn=this.$("#maximize"),this.body=this.$("#body"),this.listen(this.maximizeBtn,"click",this.handleMaximization),this.listen(this.$("#new-chat-button"),"click",this.startNewConversation),this.listen(this.$("#mobile-close-btn"),"click",(()=>n.triggerEvent("window-state",!1))),this.state.roles.length>0&&this.setupRoleListeners()}startNewConversation(){this.conversation_id=crypto.randomUUID(),this.apiService=new r(i,this.conversation_id),this.setState({messages:[],currentRole:null}),this.storage.saveConversation(this.conversation_id,null,[],!0),n.triggerEvent("answerd",!0),this.enableChat(),this.body&&(this.body.innerHTML=""),this.renderInitialMessageWithRoles(),!this.state.currentRole&&this.state.roles.length>0&&this.disableChat()}handleMaximization(){this.setState({isMaximized:!this.state.isMaximized}),this.updateMaximizeButton(),this.classList.toggle("maximize"),n.triggerEvent("maximized",this.state.isMaximized)}setupWindow(){const t=this.state.config.position||"bottom-right";this.classList.add(t),this.classList.toggle("animate-enabled",i.config.animations),!this.state.currentRole&&this.state.roles.length>0&&this.disableChat()}handleEvent(t,e){switch(t){case"window-state":this.updateVisibility(e);break;case"message-sent":this.handleUserMessage(e.message);break;case"content-updated":this.scrollToBottom();break;case"feedback-popup":this.handleFeedbackPopup(e);break;case"feedback-submitted":this.handleFeedback(e);break;case"answerd":e&&this.enableChat(),this.state.roles.length>0&&this.state.showSuggestions&&this.state.messages.length<=3||0===this.state.roles.length&&this.state.messages.length<1?this.renderSuggestionButtons():this.$(".questions-wrapper")&&this.$(".questions-wrapper").remove()}}_currentFeedbackMessageId=null;handleFeedback(t){if(!t.isFromPopup){this._currentFeedbackMessageId=parseInt(t.messageId);const e=this.state.messages.map((e=>e.userMessageId===parseInt(t.messageId)?{...e,feedback:t.type}:e));return this.setState({messages:e}),this.storage.saveConversation(this.conversation_id,this.state.currentRole,e,this.state.showSuggestions),void("positive"===t.type&&this.submitFeedback(t.type).then((()=>{this._currentFeedbackMessageId=null})))}this.submitFeedback("negative",t.feedbackText).then((()=>{this._currentFeedbackMessageId=null}))}async submitFeedback(t,e=""){const n=this.state.messages,s=n.findIndex((t=>t.userMessageId==this._currentFeedbackMessageId&&"bot"===t.sender)),i=s>0?s-1:-1;if(-1===s||-1===i)return void console.error("Could not find messages for feedback");const o=n[i],a=n[s],r={feedback:t,user_question:o.content,ai_answer:a.content,client_id:this.state.config.credentials.client_id,password:this.state.config.credentials.password,conv_id:this.conversation_id,feedback_text:e};return this.apiService.sendFeedback(r).catch((t=>console.error("Error submitting feedback:",t)))}handleFeedbackPopup(t){this.$("#feedback-popup").classList.toggle("show",t),this.listen("#feedback-popup","click",(t=>{t.target===t.currentTarget&&n.triggerEvent("feedback-popup",!1)}))}handleUserMessage(t,e=!1){if(this.state.roles.length>0&&!this.state.currentRole)return;if(!t)return;this.removeQuestionSuggestions(),this.setState({showSuggestions:!0}),this.body.querySelector('[sender="user"]')||(this.body.querySelectorAll('[is-system="true"]').forEach((t=>t.remove())),this.setState({messages:this.state.messages.filter((t=>!t.isSystem))})),this.addMessage(t,"user",!1);const n=this.addMessage("Loading ...","bot",!0);this.disableChat(),this.apiService.sendMessage(t,e).then((t=>{t.response&&(n.remove(),this.setState({messages:this.state.messages.filter((t=>!t.content.startsWith("Loading")))}),this.addMessage(t.response,"bot",!1))})).catch((t=>{n.remove(),t.response?this.addMessage(t.response.message,"bot",!0):this.addMessage("Sorry there was an error processing your request. Please try again","bot",!0),console.error("Error sending message: ",t),this.enableChat()}))}removeQuestionSuggestions(){const t=this.$(".questions-wrapper");t&&t.remove()}addMessage(t,e,n=!1){"user"===e&&(this.userMessageId=this.state.messages.length+1);const s={content:t,sender:e,isSystem:n,timestamp:Date.now(),id:this.state.messages.length+1,role:this.state.currentRole};return"bot"===e&&(s.userMessageId=this.userMessageId),this.setState({messages:[...this.state.messages,s],isInitialRender:!1}),this.storage.saveConversation(this.conversation_id,this.state.currentRole,this.state.messages,this.state.showSuggestions),this.renderMessage(s)}renderMessage(e){if(this.$("#feedback-popup")||this.renderFeedbackPopup(),!e)return;const n=document.createElement("chat-message");if(n.setAttribute("content",e.content),n.setAttribute("message-id",e.id),n.setAttribute("sender",e.sender),n.setAttribute("is-system",e.isSystem),n.setAttribute("timestamp",e.timestamp),this.state.isInitialRender&&n.setAttribute("from-storage","true"),"bot"!==e.sender||e.isSystem||(n.setAttribute("feedback-enabled","true"),n.setAttribute("user-message-id",e.userMessageId),e.feedback&&n.setAttribute("feedback-type",e.feedback)),e.isSystem&&this.state.roles.length>0&&!this.state.currentRole){const e=document.createElement("div");e.classList.add("role-container"),e.slot="extra-content",e.innerHTML=t(`\n      ${0!==this.state.roles.length?this.state.roles.map(((t,e)=>`<button class="role-btn" data-label="${t.buttonLabel}" data-index="${e}">${t.buttonLabel}</button>`)).join(""):[]}`),n.appendChild(e)}this.body.appendChild(n),this.scrollToBottom();const s=this.body.querySelectorAll('[sender="bot"]');s.forEach((t=>t.classList.remove("last-bot-message")));const i=s[s.length-1];return i&&i.classList.add("last-bot-message"),n}renderInitialMessageWithRoles(){const t=this.storage.get("messages");if(t&&t.length>0)return this.renderMessages(),void(this.state.showSuggestions&&this.state.messages.length<=3&&(0===this.state.roles.length||this.state.roles.length>0&&this.state.currentRole)&&this.renderSuggestionButtons());this.body.innerHTML="",this.addMessage(this.state.config.text.initialMessage,"bot",!0),this.state.roles.length>0?this.setupRoleListeners():(this.state.config.suggestionQuestions&&this.state.config.suggestionQuestions.length>0&&this.renderSuggestionButtons(),this.enableChat())}renderSuggestionButtons(){if(this.state.config.suggestionQuestions.length<=0)return;this.removeQuestionSuggestions();const t=this.state.config.suggestionQuestions,e=document.createElement("div");e.classList.add("questions-wrapper"),this.getTwoRandomQuestions(t).forEach((t=>{const n=document.createElement("button");n.classList.add("predefined-question"),n.textContent=t,n.addEventListener("click",(()=>{this.handleUserMessage(t,!0),e.remove(),this.storage.set("showSuggestions",!1)})),e.append(n)})),this.body.append(e)}getTwoRandomQuestions(t){if(t.length<2)return t;let e=t[Math.floor(Math.random()*t.length)],n=e;for(;n===e;)n=t[Math.floor(Math.random()*t.length)];return[e,n]}setupRoleListeners(){this.$$("chat-message .role-btn").forEach((t=>{this.listen(t,"click",(()=>{this.setState({currentRole:t.dataset.label,messages:[]}),this.handleUserMessage(t.dataset.label),this.storage.saveConversation(this.conversation_id,this.state.currentRole,this.state.messages,this.state.showSuggestions),this.enableChat()}))}))}scrollToBottom(){this.listen(this.body,"scroll",(()=>{this.setState({scrolling:this.body.scrollTop<this.body.scrollHeight-this.body.clientHeight})})),requestAnimationFrame((()=>{setTimeout((()=>{this.state.scrolling||(this.body.scrollTop=this.body.scrollHeight)}),0)}))}renderMessages(){this.body.innerHTML="",this.renderFeedbackPopup(),this.setState({isInitialRender:!0}),0!==this.state.messages.length&&(this.state.messages.forEach((t=>this.renderMessage(t))),setTimeout((()=>{this.setState({isInitialRender:!1})}),0))}renderFeedbackPopup(){const e=document.createElement("div");e.id="feedback-popup",e.className="feedback-popup",e.innerHTML=t("<feedback-popup></feedback-popup>"),this.body.appendChild(e)}updateMaximizeButton(){this.maximizeBtn.innerHTML=this.state.isMaximized?'\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"\n  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n  <polyline points="4 14 10 14 10 20" />\n  <polyline points="20 10 14 10 14 4" />\n  <line x1="14" x2="21" y1="10" y2="3" />\n  <line x1="3" x2="10" y1="21" y2="14" />\n</svg> ':o}updateVisibility(t){(this.state.currentRole||0===this.state.roles.length)&&this.autoFocusTextarea(),this.scrollToBottom(),t&&(this.style.display="flex"),this.state.config.animations?t?this.animation=this.animate({opacity:[0,1],transform:["bottom-center"===this.state.config.position?["translateY(100px)","translateY(0px)"]:["translateY(50px)","translateY(0)"]].flat(),filter:["blur(10px)","blur(0px)"],scale:[.95,1]},{duration:250}):(this.animation&&this.animation.cancel(),this.animation=this.animate({opacity:[1,0],transform:["bottom-center"===this.state.config.position?["translateY(0px)","translateY(100px)"]:["translateY(0px)","translateY(50px)"]].flat(),filter:["blur(0px)","blur(5px)"],scale:[1,.95]},{duration:250}),this.animation.onfinish=()=>{this.style.display="none"}):t||(this.style.display="none")}enableChat(){this.$("footer").style.pointerEvents="auto",this.autoFocusTextarea()}autoFocusTextarea(){requestAnimationFrame((()=>this.$("message-input").shadowRoot.querySelector("textarea")?.focus()))}disableChat(){this.$("footer").style.pointerEvents="none"}template(){const e=this.state.config.shadows?"box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.1) 0px 4px 6px -4px;":"none",n=this.state.config.titles;return t(`\n      <style>\n        :host {\n          overflow: hidden;\n          position: fixed;\n          z-index: 1;\n          /* TODO - values must be dynamic */\n          max-height: calc(100vh - 88px);\n\n          width: var(--window-width);\n          height: var(--window-height);\n\n          flex-direction: column;\n          background-color: white;\n          ${e};\n\n          border: 2px solid var(--colors-primary);\n          border-radius: var(--border-radius);\n          background-color: #f1f1f1;\n\n          display: none;\n          transition: all 250ms ease;\n\n          @media (max-width: 480px) {\n            inset: 0 !important;\n            width: 100% !important;\n            height: 100% !important;\n            max-height: 100dvh;\n\n            .maximize {\n              display: none;\n            }\n          }\n\n          & > div {\n            display: inherit;\n            flex-direction: inherit;\n            height: 100%;\n            width: 100%;\n          }\n\n          .body {\n            flex: 1;\n            padding-bottom: 10% !important;\n            display: flex;\n            gap: 2rem;\n            flex-direction: column;\n            padding: 1rem;\n            overflow-y: auto;\n\n            width: calc(100% - 16px);\n            height: calc(100% - 8px);\n            border-radius: 8px;\n            margin-inline: auto;\n            margin-bottom: 8px;\n            border: 1px solid var(--colors-border-color);\n            background-color: white;\n          }\n\n          button {\n            transition: scale 250ms ease;\n          }\n        }\n        :host(#presentation-mode) {\n          all: auto;\n          inset: 0 !important;\n          max-width: 100%;\n          max-height: 100%;\n          width: 100% !important;\n          height: 100% !important;\n          z-index: 999999;\n\n          & > div {\n            max-width: 80%;\n            margin: auto;\n            margin-top: 0 !important;\n            position: relative;\n            height: 99%;\n            display: inherit;\n            flex-direction: inherit;\n\n            @media (min-width: 1440px) {\n              max-width: 50%;\n            }\n\n            footer {\n              bottom: 0 !important;\n            }\n          }\n        }\n        :host(.maximize) {\n          width: calc(100vw - (88px * 2)) !important;\n          height: calc(100vh - (88px * 2)) !important;\n\n          .body {\n            padding-bottom: 100px !important;\n          }\n        }\n        .mobile-close-btn {\n          display: none;\n          @media (max-width: 480px) {\n            display: block;\n          }\n        }\n        .header {\n          display: flex;\n          align-items: center;\n          padding: 1rem;\n          gap: 0.5rem;\n          width: 100%;\n          color: var(--colors-text-color);\n\n          .logo {\n            width: 48px;\n            aspect-ratio: 1;\n\n            display: grid;\n            place-items: center;\n\n            & img {\n              filter: drop-shadow(0 0 1px black);\n            }\n          }\n\n          .standalone { font-size: 24px; }\n\n          .actions {\n            margin-left: auto;\n            display: flex;\n            gap: 1rem;\n\n            button {\n              color: inherit;\n\n              &:hover { scale: 1.2 }\n            }\n          }\n        }\n\n        footer {\n          position: absolute;\n          z-index: 9999;\n          background-color: white;\n          width: calc(100% - 16px);\n          bottom: 8px;\n          left: 50%;\n          transform: translateX(-50%);\n\n          border: 1px solid var(--colors-border-color);\n          border-radius: 0 0 8px 8px;\n          padding: 10px;\n        }\n\n        .feedback-popup {\n          position: absolute;\n          inset: 0;\n          background: rgba(255, 255, 255, 0.4);\n          backdrop-filter: blur(2px);\n          display: none;\n          z-index: 1;\n          place-items: center;\n        }\n        .feedback-popup.show {\n          display: grid;\n        }\n        .role-container {\n          margin-top: 12px;\n          display: flex;\n          gap: 12px;\n          flex-wrap: wrap;\n        }\n        button.role-btn {\n          padding: 6px 18px;\n          border: 1px solid var(--colors-primary);\n          color: var(--colors-primary);\n          background: white;\n          font-size: 14px;\n          border-radius: 100px;\n          transition: all 250ms ease;\n          font-weight: 600;\n\n          &:hover {\n            background-color: #eee;\n          }\n        }\n        .questions-wrapper {\n          display: flex;\n          justify-content: space-between;\n          gap: 1rem;\n          margin-top: auto;\n\n          button {\n            padding: 6px;\n            border: 1px solid var(--colors-border-color);\n            border-radius: 8px;\n            flex: 1;\n            background: white;\n            transition: all 250ms ease;\n            font-size: 12px;\n            text-align: left;\n\n            &:hover {\n              background: var(--colors-border-color);\n            }\n          }\n        }\n      </style>\n      <div>\n      <header class="header">\n        <div class="logo">\n          <img src="${this.state.config.logo_url}" alt="ChatBot logo" />\n        </div>\n        <div class="text">\n          <h3\n            class="title ${this.state.config.text.subtitle?"":"standalone"}"\n            id="title">\n            ${this.state.config.text.title}\n          </h3>\n          <p\n            class="sub-title"\n            id="sub-title">\n            ${this.state.config.text.subtitle??""}\n          </p>\n        </div>\n        <div class="actions">\n          <button\n            id="maximize"\n            class="maximize"\n            title="${n.maximize}">\n            ${o}\n          </button>\n          <button\n            id="new-chat-button"\n            title="${n.startNewChat}">\n            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M12 7v6"/><path d="M9 10h6"/></svg>\n          </button>\n          <button id="mobile-close-btn" class="mobile-close-btn">\n            \n<svg \n  xmlns="http://www.w3.org/2000/svg" \n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n  class="lucide lucide-x">\n  <path d="M18 6 6 18"/><path d="m6 6 12 12"/>\n</svg> \n          </button>\n        </div>\n      </header>\n\n      <section class="body" id="body"></section>\n\n      <footer>\n        <message-input></message-input>\n      </footer>\n      </div>\n    `)}}.define("chat-window"),class extends e{static events=["open-file-upload"];constructor(){super(),this.apiService=new r(i.config)}initState(){return{config:i.config,files:[],contactType:"email"}}handleEvent(t,e){"open-file-upload"===t&&(this.style.display="grid",this.state.config.animations&&(this.animate({opacity:[0,1],filter:["blur(10px)","blur(0px)"]},{duration:250,easing:"ease-in-out"}),this.$("#input-container").animate({scale:[.5,1],opacity:[0,1]},{duration:250,easing:"ease-in-out"})))}setupListeners(){this.listen(this,"click",this.handleClose.bind(this)),this.listen(this.$("input[type='file'"),"change",this.handleFiles.bind(this)),this.listen(this.$("#send-btn"),"click",this.handleSendFiles.bind(this)),this.listen(this.$("#close-btn"),"click",this.handleClose.bind(this)),this.listen(this.$(".contact input"),"input",this.handleContact.bind(this)),this.listen(this.$("select"),"change",this.handleContactChange.bind(this))}handleContact(t){this.enableSendBtn(),console.log(t)}handleContactChange(t){const e=t.target.value;this.setState({contactType:e});const n=this.$(".contact input"),{text:s}=this.state.config;n instanceof HTMLInputElement&&(n.type=e,n.placeholder=s.uploadFilePopup.contactInformationSection.placeholders[e])}handleClose(t){if(t.composedPath()[0]===this||t.composedPath()[0]===this.$("#close-btn"))if(this.state.config.animations){const t=this.animate({opacity:[1,0],filter:["blur(0px)","blur(10px)"]},{duration:250,easing:"ease-in-out"});this.$("#input-container").animate({scale:[1,.5],opacity:[1,0]},{duration:250,easing:"ease-in-out"}),t.onfinish=()=>this.style.display="none"}else this.style.display="none"}handleFiles(){const t=this.$("input[type='file']");if(t instanceof HTMLInputElement&&t.files){const e=[...this.state.files,...Array.from(t.files)];this.setState({files:e})}this.filesTemplate(),this.enableSendBtn()}enableSendBtn(){const t=this.$(".contact input");t instanceof HTMLInputElement&&(this.state.files.length>0&&t.value?this.$("#send-btn").removeAttribute("disabled"):this.$("#send-btn").setAttribute("disabled","true"))}handleDelete(e){const n=e.dataset.filename,s=this.state.files.filter((t=>t.name!==n));this.setState({files:s}),this.filesTemplate(),0===this.state.files.length&&(this.$("#files-wrapper").innerHTML=t(`\n        <label for="files">\n          ${a}\n          <span>${text.uploadFilePopup.buttons.selectFiles}</span>\n          <input type="file" id="files" multiple hidden accept="${this.formatAcceptString(this.state.config.files.supported)}"/>\n        </label>\n      `)),this.listen(this.$("input[type='file'"),"change",this.handleFiles.bind(this)),this.enableSendBtn()}handleSendFiles(){}formatFileSize(t){return t<1024?t+" bytes":t<1048576?(t/1024).toFixed(1)+" KB":(t/1048576).toFixed(1)+" MB"}formatAcceptString(t){return t.map((t=>`.${t}`)).join(", ")}filesTemplate(){const{text:e,titles:n}=this.state.config;this.$("#files-wrapper").innerHTML=t(`\n      ${this.state.files.length>0?`<div class="files">\n        ${this.state.files.map((t=>`<div class="file">\n          \n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="12"\n  height="12"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="currentColor"\n  stroke-width="2" \n  stroke-linecap="round"\n  stroke-linejoin="round">\n  <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>\n  <path d="M14 2v4a2 2 0 0 0 2 2h4"/>\n</svg>\n          <p title="${t.name}">${t.name}</p><span>${this.formatFileSize(t.size)}</span>\n          <button id="file-delete-btn" data-fileName="${t.name}" title="${n.removeFile}">\n            <svg \n              xmlns="http://www.w3.org/2000/svg"\n              width="12"\n              height="12"\n              viewBox="0 0 24 24"\n              fill="none"\n              stroke="currentColor"\n              stroke-width="2"\n              stroke-linecap="round"\n              stroke-linejoin="round">\n              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>\n            </svg>\n          </button>\n        </div>`)).join("")}\n\n        <label for="files" style="margin-left: auto; position: static; transform: unset;">\n          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-icon lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>\n          <span>${e.uploadFilePopup.buttons.addMore}</span>\n          <input type="file" id="files" multiple hidden accept="${this.formatAcceptString(this.state.config.files.supported)}"/>\n        </label>\n      </div>`:""}\n    `),this.$$("#file-delete-btn").forEach((t=>this.listen(t,"click",(()=>this.handleDelete(t))))),this.listen(this.$("input[type='file'"),"change",this.handleFiles.bind(this))}template(){const{text:e}=this.state.config;return t(`\n      <style>\n        :host {\n          display: none;\n\n          position: fixed;\n          z-index: 99999999999;\n\n          background: rgba(0, 0, 0, .3);\n          inset: 0;\n          place-items: center;\n          backdrop-filter: blur(3px);\n        }\n        .input-container {\n          display: flex;\n          flex-direction: column;\n\n          background: white;\n          padding: 16px;\n          width: 450px;\n          aspect-ratio: 1;\n          border: 1px solid var(--colors-primary);\n          border-radius: 16px;\n          gap: 10px;\n          color: var(--colors-text-color);\n        }\n        @media (max-width: 480px) {\n          .input-container {\n            max-width: 320px;\n            aspect-ratio: unset;\n            height: 475px;\n          }\n        }\n        .input-container section {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          overflow-y: auto;\n        }\n        #files-wrapper {\n          position: relative;\n          flex: 1;\n\n          overflow-y: auto;\n          padding: 5px;\n          border-radius: 8px;\n          border: 1px solid var(--colors-border-color);\n        }\n        #files-wrapper label {\n          padding: 8px 10px;\n          border: 1px solid var(--colors-border-color);\n          border-radius: 6px;\n          display: flex;\n          gap: 10px;\n          cursor: pointer;\n          font-size: 12px;\n          align-items: center;\n          transition: all 250ms ease;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n        }\n        label:hover {\n          background-color: #ddd;\n        }\n        .files {\n          display: flex;\n          flex-direction: column;\n          gap: 6px;\n        }\n\n        .file {\n          padding: 5px 10px;\n          border: 1px solid var(--colors-border-color);\n          border-radius: 6px;\n\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          font-size: 12px;\n          transition: all 250ms ease;\n        }\n        .file:hover {\n          background-color: #ddd;\n        }\n        .file button {\n          padding: 5px;\n          background-color: var(--colors-error);\n          border-radius: 4px;\n          opacity: 0;\n          transition: all 250ms ease;\n          color: white;\n        }\n        .file:hover button {\n          opacity: 1;\n        }\n        .file p {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          max-width: 200px;\n        }\n        .file span {\n          margin-left: auto;\n          color: #959595;\n        }\n        footer {\n          margin-top: auto;\n          display: flex;\n          justify-content: end;\n          gap: 10px;\n          align-items: center;\n        }\n        footer button {\n          padding: 4px 8px;\n          border: 1px solid var(--colors-border-color);\n          font-size: 14px;\n          border-radius: 6px;\n          transition: all 250ms ease;\n        }\n        footer button:disabled {\n          background-color: #ddd;\n          cursor: not-allowed;\n        }\n        .send-btn {\n          background-color: var(--colors-primary);\n          color: white;\n        }\n        .send-btn:not(:disabled):hover {\n          background-color: var(--colors-primary-hover);\n        }\n        .close-btn:hover {\n          background-color: #ddd;\n        }\n        select {\n          -webkit-appearance: none;\n          appearance: none;\n          padding: 10px;\n          min-width: 80px;\n          border: none;\n          background-color: #eee;\n          cursor: pointer;\n          transition: all 250ms ease;\n          outline: none;\n          font-size: 12px;\n          border-radius: 0 6px 6px 0;\n        }\n        select:hover {\n          background-color: #ccc;\n        }\n        select {\n          background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWNoZXZyb24tZG93bi1pY29uIGx1Y2lkZS1jaGV2cm9uLWRvd24iPjxwYXRoIGQ9Im02IDkgNiA2IDYtNiIvPjwvc3ZnPg==");\n          background-size: 16px;\n          background-repeat: no-repeat;\n          background-position: calc(100% - 10px) center;\n        }\n        .select-wrapper {\n          display: flex;\n          align-items: center;\n          border: 1px solid var(--colors-border-color);\n          border-radius: 8px;\n          outline: none;\n          background-color: white;\n          overflow: hidden;\n        }\n        .select-wrapper input {\n          align-self: stretch;\n          font-size: 12px;\n          padding: 0 10px;\n          width: 100%;\n          outline: none;\n          background-color: transparent;\n          border: none;\n        }\n        .info {\n          display: flex;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 8px;\n          border: 1px solid var(--colors-primary);\n          margin: 16px 0 20px;\n\n          & p {\n            line-height: 1;\n          }\n          & svg {\n            color: var(--colors-primary);\n          }\n        }\n      </style>\n      <div class="input-container" id="input-container">\n        <header>\n          <h2>${e.uploadFilePopup.title}</h2>\n          <div class="info">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert-icon lucide-circle-alert"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>\n            <p>${e.uploadFilePopup.supportedFilesNotice.prefix} ${this.state.config.files.supported.map((t=>`${t.toUpperCase()}`)).join(e.uploadFilePopup.supportedFilesNotice.separator)}</p>\n          </div>\n          <div class="contact">\n            <h4>${e.uploadFilePopup.contactInformationSection.title}</h4>\n            <div class="select-wrapper">\n              <select>\n                <option value="email" selected>${e.uploadFilePopup.contactInformationSection.options.email}</option>\n                <option value="phone">${e.uploadFilePopup.contactInformationSection.options.phone}</option>\n              </select>\n              <input type="email" placeholder="${e.uploadFilePopup.contactInformationSection.placeholders.email}" />\n            </div>\n          </div>\n        </header>\n        <section>\n          <h4>${e.uploadFilePopup.filesSection.title}</h4>\n\n          <div id="files-wrapper">\n            <label for="files">\n              ${a}\n              <span>${e.uploadFilePopup.buttons.selectFiles}</span>\n              <input type="file" id="files" multiple hidden accept="${this.formatAcceptString(this.state.config.files.supported)}"/>\n            </label>\n          </div>\n\n        </section>\n        <footer>\n          <button class="close-btn" id="close-btn">${e.uploadFilePopup.buttons.close}</button>\n          <button class="send-btn" id="send-btn" disabled>${e.uploadFilePopup.buttons.sendFiles}</button>\n        </footer>\n      </div>\n    `)}}.define("file-upload"),class extends e{static events=["window-state"];static props=["font-family"];initState(){return{config:i.config}}connectedCallback(){super.connectedCallback(),(this.state.config.autoShow||this.state.config.presentation)&&(n.triggerEvent("window-state",!0),this.$("chat-window").setAttribute("open","true")),this.state.config.autoShowDelay>0&&!this.state.config.autoShow&&setTimeout((()=>{n.triggerEvent("window-state",!0),this.$("chat-window").setAttribute("open","true")}),this.state.config.autoShowDelay),this.setAttribute("position",this.state.config.position)}handleEvent(t,e){"window-state"===t&&this.$("chat-window").setAttribute("open",e)}template(){const{colors:e,button:n,window:s}=this.state.config;return t(`\n      <style>\n        :host {\n          position: fixed;\n          display: flex;\n          flex-direction: column;\n          z-index: 5000;\n\n          --font-family: ${this.props["font-family"]};\n\n          --colors-primary: ${e.primary};\n          --colors-primary-hover: ${function(t,e,n=!1){let s=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return n?(s=Math.min(255,s+(255-s)*e/100),i=Math.min(255,i+(255-i)*e/100),o=Math.min(255,o+(255-o)*e/100)):(s=Math.max(0,s*(100+e)/100),i=Math.max(0,i*(100+e)/100),o=Math.max(0,o*(100+e)/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}${Math.round(o).toString(16).padStart(2,"0")}`}(e.primary,-20)};\n          --colors-text-color: ${e.textColor};\n          --colors-text-color-bot: ${e.tetBotColor};\n\n          --colors-user-message-background: ${e.userMessageBackground};\n          --colors-bot-message-background: ${e.botMessageBackground};\n          --colors-border-color: ${e.borderColor};\n\n          --colors-error: ${e.error};\n          --colors-success: ${e.success};\n\n          --button-width: ${n.dimensions.width+"px"};\n          --button-height: ${n.dimensions.height+"px"};\n\n          --window-width: ${s.dimensions.width+"px"};\n          --window-height: ${s.dimensions.height+"px"};\n\n          --border-radius: ${e.borderRadius+"px"};\n        }\n        :host([position="bottom-right"]) {\n          bottom: 20px;\n          right: 20px;\n        }\n        :host([position="bottom-right"]) chat-window {\n          bottom: calc(var(--button-height) + 40px);\n          right: calc(var(--button-width) + 40px);\n        }\n        :host([position="bottom-center"]) {\n          bottom: 20px;\n          left: 0;\n          right: 0;\n          margin-left: auto !important;\n          margin-right: auto !important;\n          width: fit-content;\n        }\n        :host([position="bottom-center"]) chat-window {\n          bottom: calc(var(--button-height) + 40px);\n          left: 0;\n          right: 0;\n          margin-left: auto !important;\n          margin-right: auto !important;\n        }\n        :host([position="bottom-left"]) {\n          bottom: 20px;\n          left: 20px;\n        }\n        :host([position="bottom-left"]) chat-window {\n          bottom: calc(var(--button-height) + 40px);\n          left: calc(var(--button-width) + 40px);\n        }\n      </style>\n      <chat-window open="true"></chat-window>\n      <chat-button></chat-button>\n      <file-upload></file-upload>\n    `)}}.define("luccid-chat-bot"),i.init().then((()=>{const t=document.createElement("link");t.href=i.config.font_url,t.rel="stylesheet",document.head.appendChild(t);const e=i.config.font_url.match(/family=([^:&]+)/),n=e?decodeURIComponent(e[1]).replace(/\+/g," "):"inherit",s=document.createElement("luccid-chat-bot");s.setAttribute("font-family",n),document.body.appendChild(s)})).catch((t=>{console.error("Failed to initialize config:",t)}))}();
//# sourceMappingURL=chat-bot.min.js.map

---
import MainLayout from "../layouts/MainLayout.astro"
import ProjectLink from "../components/ProjectLink.astro"

const token = import.meta.env.GITHUB_API_KEY
const url = "https://api.github.com/graphql"

const query = {
	query: `{
  search(
    type: REPOSITORY
    query: "user:jezda1337 distro-hub OR go-crud OR angular-node-crud OR nvim-html-css OR job-tracking NOT jobs-tracking"
    last: 100
  ) {
    edges {
      node {
        ... on Repository {
          id
          name
          url
          description
          openGraphImageUrl
          homepageUrl
        }
      }
    }
  }
}`,
}

const response = await fetch(url, {
	method: "POST",
	headers: {
		Authorization: `bearer ${token}`,
		"Content-Type": "application/json",
	},
	body: JSON.stringify(query),
})
const { data } = await response.json()
---

<MainLayout>
	<main class="pt-10">
		<div class="mb-6 flex">
			<h1 class="text-2xl font-medium">Some of my recent work</h1>
			<a
				target="_blank"
				class="ml-auto flex gap-2"
				href="https://github.com/jezda1337/?tab=repositories"
				class="ml-auto hover:text-blue-500">
				<span>GitHub</span>
			</a>
		</div>
		<ul class="[&>:where(li:not(:first-child))]:my-6">
			{
				data.search.edges.map((repo: any) => (
					<li>
						<ProjectLink
							name={repo.node.name}
							desc={repo.node.description}
							url={repo.node.url}
							homepageUrl={repo.node.homepageUrl}
						/>
					</li>
				))
			}
		</ul>
		<div class="my-8 flex">
			<a
				href="https://github.com/Jezda1337?tab=repositories"
				target="_blank"
				class="mx-auto decoration-wavy underline-offset-8 hover:underline"
				>All Projects</a
			>
		</div>
	</main>
</MainLayout>
